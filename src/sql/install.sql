CREATE DATABASE CCTICKET;

CONNECT TO CCTICKET USER db2 USING db2;

CREATE TABLE AREA 
(
	area_id			CHAR(2)			NOT NULL PRIMARY KEY,
	name			VARCHAR(30)		NOT NULL,
	description 	VARCHAR(100)
);

CREATE TABLE AREA_SECTION
(
	area_section_id		INT			NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
	area_id				CHAR(2)		NOT NULL,
	section_number		INT			NOT NULL,
	row_number			INT			NOT NULL,
	seats				int			NOT NULL,
	FOREIGN KEY(area_id)	REFERENCES	AREA(area_id)
);

CREATE TABLE EVENT
(
	event_id			INT			NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
	name				VARCHAR(50) NOT NULL,
	description			VARCHAR(100),
	event_date			DATE
);

CREATE TABLE EVENT_AREA_PRICE
(
	event_id			INT			NOT NULL,
	area_id				CHAR(2)		NOT NULL,
	price				DECIMAL(5,2)	NOT NULL,
	FOREIGN KEY(event_id)	REFERENCES EVENT(event_id),
	FOREIGN KEY(area_id)	REFERENCES AREA(area_id)
);

CREATE TABLE ACCOUNT
(
	account_id			INT			NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
	email				VARCHAR(50) NOT NULL UNIQUE,
	password			CHAR(128)	NOT NULL,
	firstname			VARCHAR(50) NOT NULL,
	lastname			VARCHAR(50)	NOT NULL,
	created				DATE		NOT NULL,
	account_type		CHAR		NOT NULL WITH DEFAULT 'R',
	status				CHAR		NOT NULL WITH DEFAULT 'A'
);

CREATE TABLE TICKET
(
	ticket_id			INT			NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
	event_id			INT			NOT NULL,
	area_section_id		INT 		NOT NULL,
	account_id			INT			NOT NULL,
	seat_number			INT,
	sales_price			DECIMAL(6,2) NOT NULL,
	date_purchased		DATE		NOT NULL,
	FOREIGN KEY(event_id) REFERENCES EVENT(event_id),
	FOREIGN KEY(area_section_id) REFERENCES AREA_SECTION(area_section_id),
	FOREIGN KEY(account_id)	REFERENCES ACCOUNT(account_id)
);

INSERT INTO ACCOUNT (ACCOUNT_ID, EMAIL, PASSWORD, FIRSTNAME, LASTNAME, CREATED, ACCOUNT_TYPE, STATUS) VALUES (0, 'admin', 'fd76c939bc09d6b199de60664efefc3770fce16b1e957d2482bd9e0a293eb321016dec42cd4e51f0dc141bbe929c4368098a0e7d37e8a0447fd08b82f50f91b2', 'Super', 'Admin', CURRENT DATE, 'A', DEFAULT);

/*
CREATE TABLE USERS ( 
    USERNAME VARCHAR (25)  NOT NULL , 
    PASSWORD CHAR(128)  NOT NULL , 
    FIRSTNAME VARCHAR (50),
    LASTNAME VARCHAR (50),
    JOINED DATE  NOT NULL, 
    STATUS CHARACTER (1)  NOT NULL  WITH DEFAULT 'A', 
    PRIMARY KEY (USERNAME)  
);

insert into users ( username, password, firstname, lastname, joined, status) VALUES ('admin', 'c7ad44cbad762a5da0a452f9e854fdc1e0e7a52a38015f23f3eab1d80b931dd472634dfac71cd34ebc35d16ab7fb8a90c81f975113d6c7538dc69dd8de9077ec', 'Augusto', 'Go', current date, default);
*/

DISCONNECT CCTICKET;